<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººè®¾ç½® - å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/students.css">
</head>

<body>
    <header class="top-header">
        <div class="header-left">
            <div class="logo">ğŸ“š</div>
            <h1>å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</h1>
            <span class="user-badge">å­¦ç”Ÿç«¯</span>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2338ef7d'/%3E%3Ctext x='50' y='50' text-anchor='middle' dy='.3em' fill='white' font-size='40' font-family='Arial'%3Eå­¦%3C/text%3E%3C/svg%3E"
                        alt="ç”¨æˆ·å¤´åƒ">
                    <span class="username" id="displayName">å­¦ç”Ÿ</span>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <div class="nav-item" onclick="location.href='index.html'"><span class="nav-icon">ğŸ“Š</span><span class="nav-text">æˆ‘çš„æ¦‚è§ˆ</span></div>
                <div class="nav-item" onclick="location.href='my-info.html'"><span class="nav-icon">ğŸ‘¨â€ğŸ“</span><span class="nav-text">æˆ‘çš„ä¿¡æ¯</span></div>
                <div class="nav-item" onclick="location.href='my-status.html'"><span class="nav-icon">ğŸ“‹</span><span class="nav-text">æˆ‘çš„å­¦ç±</span></div>
                <div class="nav-item" onclick="location.href='my-practice.html'"><span class="nav-icon">ğŸ†</span><span class="nav-text">ç¤¾ä¼šå®è·µ</span></div>
                <div class="nav-item" onclick="location.href='my-reward.html'"><span class="nav-icon">ğŸ–ï¸</span><span class="nav-text">å¥–æƒ©è®°å½•</span></div>
                <div class="nav-item" onclick="location.href='my-scores.html'"><span class="nav-icon">ğŸ“</span><span class="nav-text">æˆ‘çš„æˆç»©</span></div>
                <div class="nav-item" onclick="location.href='courses.html'"><span class="nav-icon">ğŸ“š</span><span class="nav-text">è¯¾ç¨‹æŸ¥è¯¢</span></div>
                <div class="nav-item active"><span class="nav-icon">ğŸ‘¤</span><span class="nav-text">ä¸ªäººè®¾ç½®</span></div>
            </nav>
            <div class="sidebar-footer">
                <div class="nav-item" id="logoutBtn"><span class="nav-icon">ğŸšª</span><span class="nav-text">é€€å‡ºç™»å½•</span></div>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <div>
                    <h2>ğŸ‘¤ ä¸ªäººè®¾ç½®</h2>
                    <p class="subtitle">ä¿®æ”¹å¯†ç ç­‰ä¸ªäººè®¾ç½®</p>
                </div>
            </div>

            <!-- è´¦å·ä¿¡æ¯ -->
            <div class="settings-card">
                <h3>è´¦å·ä¿¡æ¯</h3>
                <div class="info-row">
                    <label>ç”¨æˆ·å</label>
                    <span id="username">-</span>
                </div>
                <div class="info-row">
                    <label>çœŸå®å§“å</label>
                    <span id="realName">-</span>
                </div>
                <div class="info-row">
                    <label>ç”¨æˆ·ç±»å‹</label>
                    <span id="userType">å­¦ç”Ÿ</span>
                </div>
            </div>

            <!-- ä¿®æ”¹å¯†ç  -->
            <div class="settings-card">
                <h3>ä¿®æ”¹å¯†ç </h3>
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="oldPassword">åŸå¯†ç </label>
                        <input type="password" id="oldPassword" placeholder="è¯·è¾“å…¥åŸå¯†ç " required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">æ–°å¯†ç </label>
                        <input type="password" id="newPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">ç¡®è®¤æ–°å¯†ç </label>
                        <input type="password" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " required>
                    </div>
                    <button type="submit" class="btn-primary">ä¿®æ”¹å¯†ç </button>
                </form>
            </div>
        </main>
    </div>

    <style>
        .user-badge { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px; }
        .settings-card { background: white; border-radius: 16px; padding: 30px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); margin-bottom: 20px; }
        .settings-card h3 { font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 20px; padding-left: 12px; border-left: 3px solid var(--primary-color); }
        .info-row { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
        .info-row:last-child { border-bottom: none; }
        .info-row label { width: 120px; color: var(--text-secondary); font-size: 14px; }
        .info-row span { color: var(--text-primary); font-size: 14px; font-weight: 500; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px; }
        .form-group input { width: 100%; max-width: 400px; padding: 12px 16px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; transition: border-color 0.3s; }
        .form-group input:focus { outline: none; border-color: var(--primary-color); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
    </style>

    <script src="../js/common.js"></script>
    <script src="js/student-common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (!initStudentPage()) return;
            loadProfileInfo();
            initPasswordForm();
        });

        async function loadProfileInfo() {
            try {
                const res = await studentFetch(`${API_BASE}/profile/info`);
                const data = await res.json();
                
                if (data.code === 1 && data.data) {
                    const info = data.data;
                    document.getElementById('username').textContent = info.username || '-';
                    document.getElementById('realName').textContent = info.realName || '-';
                    document.getElementById('userType').textContent = info.userType === 'student' ? 'å­¦ç”Ÿ' : 'ç®¡ç†å‘˜';
                }
            } catch (err) {
                console.error('åŠ è½½è´¦å·ä¿¡æ¯å¼‚å¸¸:', err);
            }
        }

        function initPasswordForm() {
            const form = document.getElementById('passwordForm');
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const oldPassword = document.getElementById('oldPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (newPassword !== confirmPassword) {
                    showMessage('ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´', 'error');
                    return;
                }
                
                if (newPassword.length < 6) {
                    showMessage('æ–°å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½', 'error');
                    return;
                }
                
                try {
                    const res = await studentFetch(`${API_BASE}/profile/password`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ oldPassword, newPassword })
                    });
                    const data = await res.json();
                    
                    if (data.code === 1) {
                        showMessage('å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•', 'success');
                        setTimeout(() => {
                            localStorage.removeItem('authentication');
                            localStorage.removeItem('currentUser');
                            window.location.href = '../html/login.html';
                        }, 2000);
                    } else {
                        showMessage(data.msg || 'å¯†ç ä¿®æ”¹å¤±è´¥', 'error');
                    }
                } catch (err) {
                    console.error('ä¿®æ”¹å¯†ç å¼‚å¸¸:', err);
                    showMessage('ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•', 'error');
                }
            });
        }
    </script>
</body>
</html>
