<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æˆç»© - å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/students.css">
</head>

<body>
    <header class="top-header">
        <div class="header-left">
            <div class="logo">ğŸ“š</div>
            <h1>å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</h1>
            <span class="user-badge">å­¦ç”Ÿç«¯</span>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2338ef7d'/%3E%3Ctext x='50' y='50' text-anchor='middle' dy='.3em' fill='white' font-size='40' font-family='Arial'%3Eå­¦%3C/text%3E%3C/svg%3E"
                        alt="ç”¨æˆ·å¤´åƒ">
                    <span class="username" id="displayName">å­¦ç”Ÿ</span>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <div class="nav-item" onclick="location.href='index.html'"><span class="nav-icon">ğŸ“Š</span><span class="nav-text">æˆ‘çš„æ¦‚è§ˆ</span></div>
                <div class="nav-item" onclick="location.href='my-info.html'"><span class="nav-icon">ğŸ‘¨â€ğŸ“</span><span class="nav-text">æˆ‘çš„ä¿¡æ¯</span></div>
                <div class="nav-item" onclick="location.href='my-status.html'"><span class="nav-icon">ğŸ“‹</span><span class="nav-text">æˆ‘çš„å­¦ç±</span></div>
                <div class="nav-item" onclick="location.href='my-practice.html'"><span class="nav-icon">ğŸ†</span><span class="nav-text">ç¤¾ä¼šå®è·µ</span></div>
                <div class="nav-item" onclick="location.href='my-reward.html'"><span class="nav-icon">ğŸ–ï¸</span><span class="nav-text">å¥–æƒ©è®°å½•</span></div>
                <div class="nav-item active"><span class="nav-icon">ğŸ“</span><span class="nav-text">æˆ‘çš„æˆç»©</span></div>
                <div class="nav-item" onclick="location.href='courses.html'"><span class="nav-icon">ğŸ“š</span><span class="nav-text">è¯¾ç¨‹æŸ¥è¯¢</span></div>
                <div class="nav-item" onclick="location.href='profile.html'"><span class="nav-icon">ğŸ‘¤</span><span class="nav-text">ä¸ªäººè®¾ç½®</span></div>
            </nav>
            <div class="sidebar-footer">
                <div class="nav-item" id="logoutBtn"><span class="nav-icon">ğŸšª</span><span class="nav-text">é€€å‡ºç™»å½•</span></div>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <div>
                    <h2>ğŸ“ æˆ‘çš„æˆç»©</h2>
                    <p class="subtitle">æŸ¥çœ‹å„å­¦æœŸè¯¾ç¨‹æˆç»©</p>
                </div>
            </div>

            <!-- æˆç»©ç»Ÿè®¡ -->
            <div class="stats-row">
                <div class="stat-item">
                    <span class="stat-label">æ€»è¯¾ç¨‹æ•°</span>
                    <span class="stat-value" id="totalCourses">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">å·²é€šè¿‡</span>
                    <span class="stat-value passed" id="passedCourses">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">å¹³å‡ç»©ç‚¹</span>
                    <span class="stat-value" id="avgGpa">-</span>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>å­¦æœŸ</th>
                            <th>è¯¾ç¨‹ä»£ç </th>
                            <th>è¯¾ç¨‹åç§°</th>
                            <th>å­¦åˆ†</th>
                            <th>å¹³æ—¶æˆç»©</th>
                            <th>æœŸä¸­æˆç»©</th>
                            <th>æœŸæœ«æˆç»©</th>
                            <th>æ€»è¯„æˆç»©</th>
                            <th>ç»©ç‚¹</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="scoreTableBody">
                        <tr><td colspan="10" class="empty-message">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <style>
        .user-badge { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px; }
        .stats-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-item { background: white; border-radius: 12px; padding: 20px 30px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); display: flex; flex-direction: column; align-items: center; }
        .stat-label { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; }
        .stat-value { font-size: 24px; font-weight: 700; color: var(--text-primary); }
        .stat-value.passed { color: #2e7d32; }
        .table-container { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); overflow-x: auto; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 12px 14px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .data-table th { background: var(--bg-secondary); font-weight: 600; color: var(--text-secondary); font-size: 13px; }
        .data-table td { font-size: 14px; color: var(--text-primary); }
        .data-table tbody tr:hover { background: var(--bg-secondary); }
        .empty-message { text-align: center; color: var(--text-secondary); padding: 40px !important; }
        .score-pass { color: #2e7d32; font-weight: 600; }
        .score-fail { color: #c62828; font-weight: 600; }
        .status-tag { padding: 4px 10px; border-radius: 10px; font-size: 12px; }
        .status-tag.pass { background: #e8f5e9; color: #2e7d32; }
        .status-tag.fail { background: #ffebee; color: #c62828; }
    </style>

    <script src="../js/common.js"></script>
    <script src="js/student-common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (!initStudentPage()) return;
            loadMyScores();
        });

        async function loadMyScores() {
            try {
                const res = await studentFetch(`${API_BASE}/student-portal/my-scores`);
                const data = await res.json();
                
                const tbody = document.getElementById('scoreTableBody');
                
                if (data.code === 1 && data.data && data.data.length > 0) {
                    const scores = data.data;
                    
                    // ç»Ÿè®¡
                    document.getElementById('totalCourses').textContent = scores.length;
                    const passed = scores.filter(s => s.isPass).length;
                    document.getElementById('passedCourses').textContent = passed;
                    
                    const validGpa = scores.filter(s => s.gradePoint != null);
                    if (validGpa.length > 0) {
                        const avgGpa = validGpa.reduce((sum, s) => sum + s.gradePoint, 0) / validGpa.length;
                        document.getElementById('avgGpa').textContent = avgGpa.toFixed(2);
                    }
                    
                    tbody.innerHTML = scores.map(item => `
                        <tr>
                            <td>${item.semesterName || '-'}</td>
                            <td>${item.courseCode || '-'}</td>
                            <td>${item.courseName || '-'}</td>
                            <td>${item.credits || '-'}</td>
                            <td>${item.regularScore != null ? item.regularScore : '-'}</td>
                            <td>${item.midtermScore != null ? item.midtermScore : '-'}</td>
                            <td>${item.finalScore != null ? item.finalScore : '-'}</td>
                            <td class="${item.isPass ? 'score-pass' : 'score-fail'}">${item.totalScore != null ? item.totalScore : '-'}</td>
                            <td>${item.gradePoint != null ? item.gradePoint : '-'}</td>
                            <td><span class="status-tag ${item.isPass ? 'pass' : 'fail'}">${item.isPass ? 'é€šè¿‡' : 'æœªé€šè¿‡'}</span></td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="10" class="empty-message">æš‚æ— æˆç»©è®°å½•</td></tr>';
                }
            } catch (err) {
                console.error('åŠ è½½æˆç»©å¼‚å¸¸:', err);
                document.getElementById('scoreTableBody').innerHTML = '<tr><td colspan="10" class="empty-message">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</td></tr>';
            }
        }
    </script>
</body>
</html>
